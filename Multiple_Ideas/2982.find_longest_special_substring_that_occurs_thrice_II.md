# 2982.æ‰¾å‡ºå‡ºç°è‡³å°‘ä¸‰æ¬¡çš„æœ€é•¿ç‰¹æ®Šå­å­—ç¬¦ä¸² II

é¢˜ç›®é“¾æ¥ï¼š[2982.æ‰¾å‡ºå‡ºç°è‡³å°‘ä¸‰æ¬¡çš„æœ€é•¿ç‰¹æ®Šå­å­—ç¬¦ä¸² II](https://leetcode.cn/problems/find-longest-special-substring-that-occurs-thrice-ii/)

## é¢˜ç›®å¤§æ„

ç»™ä½ ä¸€ä¸ªä»…ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸² `s` 

å¦‚æœä¸€ä¸ªå­—ç¬¦ä¸²ä»…ç”±å•ä¸€å­—ç¬¦ç»„æˆï¼Œé‚£ä¹ˆå®ƒè¢«ç§°ä¸ºç‰¹æ®Šå­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸² `"abc"` ä¸æ˜¯ç‰¹æ®Šå­—ç¬¦ä¸²ï¼Œè€Œå­—ç¬¦ä¸² `"ddd"`ã€`"zz"` å’Œ `"f"` æ˜¯ç‰¹æ®Šå­—ç¬¦ä¸²

è¿”å›åœ¨ `s` ä¸­å‡ºç°è‡³å°‘ä¸‰æ¬¡çš„æœ€é•¿ç‰¹æ®Šå­å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå¦‚æœä¸å­˜åœ¨å‡ºç°è‡³å°‘ä¸‰æ¬¡çš„ç‰¹æ®Šå­å­—ç¬¦ä¸²ï¼Œåˆ™è¿”å› `-1` 

å­å­—ç¬¦ä¸² æ˜¯å­—ç¬¦ä¸²ä¸­çš„ä¸€ä¸ªè¿ç»­ éç©º å­—ç¬¦åºåˆ—

```js
Example 1:
Input: s = "aaaa"
Output: 2
Explanation: The longest special substring which occurs thrice is "aa": substrings "aaaa", "aaaa", and "aaaa".
It can be shown that the maximum length achievable is 2.

Example 2:
Input: s = "abcdef"
Output: -1
Explanation: There exists no special substring which occurs at least thrice. Hence return -1.

Example 3:
Input: s = "abcaba"
Output: 1
Explanation: The longest special substring which occurs thrice is "a": substrings "abcaba", "abcaba", and "abcaba".
It can be shown that the maximum length achievable is 1.
```

é™åˆ¶ï¼š
- 3 <= s.length <= 5 * 10^5
- s consists of only lowercase English letters.

## è§£é¢˜

æš´åŠ›æ€è·¯ï¼š
- æš´åŠ›å°è¯•æ‰€æœ‰å­ä¸²ï¼Œç»Ÿè®¡æ¯ä¸ªå­ä¸²åœ¨å­—ç¬¦ä¸²ä¸­å‡ºç°çš„æ¬¡æ•°
- æšä¸¾æ‰€æœ‰å­ä¸² `s[i:j]`ï¼Œç„¶ååœ¨ `s` é‡Œç»Ÿè®¡å‡ºç°æ¬¡æ•°
- ä½†å­—ç¬¦ä¸²é•¿åº¦ä¸º `n` æ—¶ï¼Œå­ä¸²æ•°é‡ `O(nÂ²)`ï¼Œç»Ÿè®¡ä¸€æ¬¡å‡ºç°åˆæ˜¯ `O(n)`ï¼Œæ€»å¤æ‚åº¦ `O(nÂ³)`ï¼Œå¤ªå¤§

### æ€è·¯ 1: äºŒåˆ†ç­”æ¡ˆ

æˆ‘ä»¬éœ€è¦æ‰¾åˆ°æœ€å¤§çš„ `k`ï¼Œæ»¡è¶³å‡ºç°æ¬¡æ•° `â‰¥ 3`ï¼›å¦‚æœä»å°åˆ°å¤§æšä¸¾ `k`ï¼Œæ¯ä¸ª `k` éƒ½è¦æ‰«æç»Ÿè®¡ï¼Œæ—¶é—´å¤§ï¼Œæ•ˆç‡ä½

è€ƒè™‘ï¼š`äºŒåˆ†ç­”æ¡ˆ`
- å¯¹äºæŸä¸ªå­—ç¬¦ï¼Œæœ€å° `k = 1`ï¼Œæœ€å¤§ `k = n`
- ç”¨äºŒåˆ†çŒœä¸€ä¸ª `kï¼ˆmidï¼‰`ï¼Œç„¶åç»Ÿè®¡æ‰€æœ‰æ®µé‡Œé•¿åº¦ `â‰¥ mid` çš„è´¡çŒ®ä¹‹å’Œï¼Œçœ‹æ˜¯å¦ `â‰¥ 3`ï¼š
  - å¦‚æœ `â‰¥ 3`ï¼Œè¯´æ˜è¿˜èƒ½æ›´å¤§ï¼Œå°è¯•å¢å¤§ `kï¼ˆlow = mid + 1ï¼‰`
  - å¦åˆ™å‡å° `kï¼ˆhigh = mid - 1ï¼‰`
- å¥½å¤„ï¼š
  - æŠŠæ±‚æœ€å¤§ `k` çš„è¿‡ç¨‹ä» `O(n)` é™åˆ° `O(logn)`
  - æ€»ä½“å¤æ‚åº¦ `O(C * N * log N)`ï¼Œ`C` æ˜¯å­—ç¬¦ç§ç±»ï¼ˆæœ€å¤š `26`ï¼‰

> æœ¬é¢˜ä¸ºä»€ä¹ˆå¯ä»¥ç”¨äºŒåˆ†ï¼Ÿ- å› ä¸ºéšç€é•¿åº¦ `k` çš„å¢åŠ ï¼Œæ»¡è¶³å‡ºç°æ¬¡æ•° `â‰¥3` çš„æ¡ä»¶å…·æœ‰ å•è°ƒæ€§ï¼Œæ— éœ€å¯¹åŸæ•°æ®æ’åº

> æœ¬é¢˜ä¸ºä»€ä¹ˆæ»¡è¶³å•è°ƒæ€§ï¼Ÿ
> - å¯¹äºå›ºå®šçš„å­—ç¬¦æ®µï¼Œå­ä¸²é•¿åº¦è¶Šå¤§ï¼Œå¯å½¢æˆçš„å­ä¸²æ•°è¶Šå°‘
> æ‰€ä»¥ï¼š
> - å¦‚æœé•¿åº¦ `k` å·²ç»å‡ºç°æ¬¡æ•° `â‰¥ 3`ï¼Œé‚£æ›´å°çš„é•¿åº¦ä¸€å®šæ›´å®¹æ˜“å‡ºç°æ¬¡æ•° `â‰¥3`
> -å¦‚æœé•¿åº¦ `k` å‡ºç°æ¬¡æ•° `< 3`ï¼Œé‚£æ›´å¤§çš„é•¿åº¦ä¹Ÿä¸å¯èƒ½å‡ºç°æ›´å¤š
> ğŸ‘‰ æ»¡è¶³â€œå¯è¡Œæ€§å•è°ƒâ€

> ä¸ºä»€ä¹ˆä¸éœ€è¦æ’åºï¼Ÿ
> - æˆ‘ä»¬ä¸æ˜¯åœ¨ `vec` é‡Œç”¨äºŒåˆ†æ‰¾æŸä¸ªå…ƒç´ ï¼Œè€Œæ˜¯åœ¨â€œé•¿åº¦ç©ºé—´â€ `[1, n-2]` ä¸ŠåšäºŒåˆ†ï¼š
>   - æ¯æ¬¡å°è¯•ä¸€ä¸ªé•¿åº¦ `mid`
>   - ç»Ÿè®¡æ‰€æœ‰æ®µé‡Œé•¿åº¦ `â‰¥mid` çš„å­ä¸²æ•°é‡
>   - æ ¹æ®è¿™ä¸ªç»Ÿè®¡ç»“æœå†³å®šå¾€å“ªä¸€è¾¹æœç´¢
> é•¿åº¦ç©ºé—´æœ¬èº«æ˜¯å¤©ç„¶æœ‰åºçš„æ•´æ•°èŒƒå›´ [1, n-2]ï¼Œæ‰€ä»¥ç›´æ¥å¯ä»¥äºŒåˆ†

```python
class Solution:
    def maximumLength(self, s: str) -> int:
        # n æ˜¯å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œç”¨äºåç»­è¾¹ç•Œ
        n = len(s)
        # ç”¨å­—å…¸ count å­˜æ¯ç§å­—ç¬¦å¯¹åº”çš„è¿ç»­æ®µé•¿åº¦åˆ—è¡¨
        # å¦‚ï¼š"aaabbc" â†’ count['a'] = [3], count['b'] = [2], count['c'] = [1]
        count = {}

        # å¤–å±‚ i ä»å·¦åˆ°å³æ‰«æ s
        i = 0
        while i < n:
            # å†…å±‚ j ä» i å¼€å§‹å‘å³æ‰©å±•ï¼Œæ‰¾åˆ°ä¸€æ®µè¿ç»­ç›¸åŒå­—ç¬¦ s[i:j]
            j = i
            while j < n and s[j] == s[i]:
                j += 1
            
            # å¦‚æœè¿™ä¸ªå­—ç¬¦ç¬¬ä¸€æ¬¡å‡ºç°ï¼Œåˆå§‹åŒ–ä¸€ä¸ªç©ºåˆ—è¡¨
            if s[i] not in count:
                count[s[i]] = []
            
            # æŠŠè¿™ä¸€æ®µè¿ç»­ç›¸åŒå­—ç¬¦çš„é•¿åº¦ j-i å­˜å…¥å¯¹åº”å­—ç¬¦çš„åˆ—è¡¨
            count[s[i]].append(j - i)

            # ç§»åŠ¨ i åˆ° jï¼Œç»§ç»­å¤„ç†ä¸‹ä¸€æ®µ
            i = j
        
        # äºŒåˆ†æŸ¥æ‰¾éƒ¨åˆ†
        # åˆå§‹åŒ–ç­”æ¡ˆï¼Œé»˜è®¤æ‰¾ä¸åˆ°è¿”å› -1
        res = -1
        # éå†æ¯ä¸ªå­—ç¬¦çš„æ‰€æœ‰è¿ç»­æ®µé•¿åº¦åˆ—è¡¨ vec
        for vec in count.values():
            # æœ€çŸ­å­ä¸²é•¿åº¦ä» 1 å¼€å§‹
            # ä¸ºä»€ä¹ˆ high = n-2ï¼Ÿå› ä¸ºæˆ‘ä»¬è¦è‡³å°‘å‡ºç° 3 æ¬¡ï¼Œè‹¥å­ä¸²é•¿åº¦ç­‰äº n æˆ– n-1ï¼Œå‡ºç°æ¬¡æ•°ä¸€å®šä¸è¶³ 3 æ¬¡ï¼›å– n-2 è¶³å¤Ÿ
            low, high = 1, n - 2
            while low <= high:
                # äºŒåˆ†æœç´¢é•¿åº¦ mid
                mid = (low + high) // 2
                # å¯¹äºæ¯æ®µé•¿åº¦ xï¼š
                # - å¦‚æœè¿™æ®µè¶³å¤Ÿé•¿ï¼ˆx >= midï¼‰ï¼Œå®ƒèƒ½è´¡çŒ® x-mid+1 ä¸ªé•¿åº¦ä¸º mid çš„å­ä¸²
                # - æŠŠæ‰€æœ‰æ®µçš„è´¡çŒ®åŠ èµ·æ¥
                count = 0
                for x in vec:
                    if x >= mid:
                        count += x - mid + 1

                # å¦‚æœå‡ºç°æ¬¡æ•° count â‰¥ 3ï¼šè¯´æ˜é•¿åº¦ mid å¯è¡Œï¼Œå°è¯•æ›´é•¿çš„å­ä¸²ï¼Œlow = mid + 1
                # æ›´æ–°ç­”æ¡ˆ res
                if count >= 3:
                    res = max(res, mid)
                    low = mid + 1
                else:
                    # å¦åˆ™è¯´æ˜ mid å¤ªå¤§ï¼Œç¼©å°èŒƒå›´
                    high = mid - 1
        return res
```

- æ—¶é—´å¤æ‚åº¦ï¼š`O(nlogn)`ï¼Œå…¶ä¸­ `n` è¡¨ç¤ºå­—ç¬¦ä¸²çš„é•¿åº¦
  - æ„é€ è¿ç»­æ®µï¼š`O(n)`
  - å¯¹æ¯ä¸ªå­—ç¬¦äºŒåˆ†æŸ¥æ‰¾ï¼š`O(logn)`ï¼Œæ¯æ¬¡ç»Ÿè®¡éå†è¯¥å­—ç¬¦çš„æ®µæ•°ï¼Œæ‰€æœ‰æ®µåŠ èµ·æ¥æ€»é•¿ `O(n)`
- ç©ºé—´å¤æ‚åº¦ï¼š`O(n)`ï¼Œå…¶ä¸­ `n` è¡¨ç¤ºå­—ç¬¦ä¸²çš„é•¿åº¦ã€‚éœ€å­˜å‚¨æ¯ç§å­—ç¬¦å­—ç¬¦ä¸²ä¸­è¿ç»­ç›¸åŒå­—ç¬¦çš„é•¿åº¦ï¼Œå­˜å‚¨ç©ºé—´æœ€å¤šä¸º `O(n)`
  
### æ€è·¯ 2: Run-Length Decompositionï¼ˆæŒ‰å­—ç¬¦åˆ†æ®µç»Ÿè®¡ï¼‰ + Topâ€‘K Run Analysisï¼ˆå–å‰ä¸‰å¤§æ®µï¼‰

è§‚å¯Ÿåˆ°å­ä¸²å¿…é¡»æ˜¯åŒä¸€ä¸ªå­—ç¬¦è¿ç»­é‡å¤ç»„æˆçš„ï¼Œæ‰€ä»¥ï¼š
- æˆ‘ä»¬åªéœ€è€ƒè™‘æ¯ä¸ªå­—ç¬¦çš„è¿ç»­æ®µï¼ˆ`run`ï¼‰
- å¯¹äºæŸä¸ªå­—ç¬¦ï¼Œæƒ³è®© `"aaa"` å‡ºç° `3` æ¬¡ï¼Œè‡³å°‘è¦æœ‰ä¸€ä¸ªæ®µé•¿åº¦ `â‰¥ 3`ï¼Œæˆ–è€…å¤šä¸ªæ®µæ‹¼èµ·æ¥æ»¡è¶³æ¡ä»¶

ä»”ç»†æƒ³æ¡ä»¶ï¼š**å¦‚æœæŸä¸ªæ®µé•¿åº¦ L â‰¥ k**ï¼Œé‚£ä¹ˆè¿™ä¸ªæ®µæœ¬èº«å°±èƒ½è´¡çŒ® (`L-k+1`) æ¬¡å‡ºç°ï¼ˆæ»‘åŠ¨çª—å£ï¼‰ã€‚æ‰€ä»¥å¦‚æœéœ€è¦å‡ºç° `â‰¥3` æ¬¡ï¼Œæœ‰ä¸‰ç§æƒ…å†µï¼š
- å•ä¸ªæ®µå†…éƒ¨è´¡çŒ® `â‰¥3` æ¬¡ï¼šåªè¦ `L-2 â‰¥ k â‡’ k â‰¤ L-2`
- ä¸¤ä¸ªæ®µæ‹¼è´¡çŒ® `â‰¥3` æ¬¡ï¼šä¸€ä¸ªæ®µè´¡çŒ® `â‰¥2` æ¬¡ï¼ˆ`k â‰¤ L-1`ï¼‰ä¸”å¦ä¸€ä¸ªæ®µè´¡çŒ® `â‰¥1` æ¬¡
- ä¸‰ä¸ªç‹¬ç«‹æ®µå„è´¡çŒ® `1` æ¬¡ï¼šåªè¦æœ‰ `3` ä¸ªæ®µé•¿åº¦ `â‰¥ k` â‡’ å–æœ€å°æ®µé•¿åº¦

ä¼˜åŒ–çš„æ ¸å¿ƒï¼š
- æˆ‘ä»¬å¯¹æ¯ä¸ªå­—ç¬¦ï¼Œåªéœ€çŸ¥é“å®ƒçš„å‰ä¸‰å¤§æ®µé•¿åº¦ï¼ˆæœ€å¤§æ®µã€ç¬¬äºŒå¤§æ®µã€ç¬¬ä¸‰å¤§æ®µï¼‰ï¼Œå°±èƒ½é€šè¿‡ä¸Šé¢ä¸‰ç§ç»„åˆç®—å‡ºæœ€å¤§çš„ `k`
- ä¸éœ€è¦ç»Ÿè®¡æ‰€æœ‰ `l`

æ€è·¯ï¼š
- æ‰«æ `s`ï¼ŒæŒ‰å­—ç¬¦åˆ†ç»„ï¼Œè®°å½•æ¯ä¸ªå­—ç¬¦å‡ºç°çš„æœ€é•¿ä¸‰æ®µè¿ç»­é•¿åº¦
- ç„¶åæšä¸¾è¿™ä¸‰æ®µé•¿åº¦ï¼Œå¥—ç”¨å…¬å¼ï¼š
  - `vec[0] - 2` ï¼ˆä¸€ä¸ªæ®µå†…éƒ¨æ»‘çª— `â‰¥3`ï¼‰
  - `min(vec[0]-1, vec[1])`ï¼ˆä¸¤ä¸ªæ®µç»„åˆï¼‰
  - `vec[2]`ï¼ˆä¸‰ä¸ªæ®µå„è´¡çŒ®ä¸€æ¬¡ï¼‰
- ä¸‰è€…å–æœ€å¤§å€¼

```python
class Solution:
    def maximumLength(self, s: str) -> int:
        n = len(s)
        # count æ˜¯ä¸€ä¸ª 26Ã—3 çš„æ•°ç»„ï¼Œç”¨æ¥è®°å½•æ¯ä¸ªå­—ç¬¦çš„å‰ä¸‰å¤§æ®µé•¿åº¦
        # ä¸‹æ ‡ï¼š0 è¡¨ç¤ºæœ€é•¿æ®µï¼Œ1 è¡¨ç¤ºç¬¬äºŒé•¿ï¼Œ2 è¡¨ç¤ºç¬¬ä¸‰é•¿
        count = [[0] * 3 for _ in range(26)]
        
        # æ‰«æè¿ç»­æ®µ
        i = 0
        # å¤–å±‚ i éå†å­—ç¬¦ä¸²
        while i < n:
            # å†…å±‚ j ä» i å¼€å§‹å‘å³æ‰©å±•ï¼Œæ‰¾åˆ°ä¸€æ®µç›¸åŒå­—ç¬¦ s[i:j]
            j = i
            while j < n and s[j] == s[i]:
                j += 1
            
            # indexï¼šå½“å‰å­—ç¬¦å¯¹åº” count ä¸­çš„ä¸‹æ ‡ï¼ˆaâ†’0ï¼Œbâ†’1â€¦ï¼‰
            index = ord(s[i]) - ord('a')
            # lengthï¼šå½“å‰è¿™æ®µè¿ç»­ç›¸åŒå­—ç¬¦çš„é•¿åº¦
            length = j - i

            # ç»´æŠ¤å‰ä¸‰å¤§æ®µé•¿åº¦
            # å¦‚æœå½“å‰æ®µé•¿åº¦å¤§äºå½“å‰è®°å½•çš„æœ€å¤§æ®µ (count[index][0])
            if length > count[index][0]:
                # æ›´æ–°ï¼šæ–°çš„æœ€å¤§æ®µé•¿åº¦æ”¾åœ¨ [0]ï¼›åŸæ¥çš„æœ€å¤§æ®µå’Œæ¬¡å¤§æ®µä¾æ¬¡å‘åæŒª
                count[index][0], count[index][1], count[index][2] = length, count[index][0], count[index][1]
            elif length > count[index][1]:
                # å¦åˆ™ï¼Œå¦‚æœæ¯”æœ€å¤§æ®µå°ï¼Œä½†æ¯”æ¬¡å¤§æ®µå¤§
                # æ›´æ–°ï¼šæ–°çš„å€¼æ”¾åœ¨ [1]ï¼ŒåŸæ¬¡å¤§æ®µæŒªåˆ° [2]
                count[index][1], count[index][2] = length, count[index][1]
            elif length > count[index][2]:
                # å¦åˆ™ï¼Œå¦‚æœæ¯”å‰ä¸¤ä¸ªéƒ½å°ä½†æ¯”ç¬¬ä¸‰å¤§æ®µå¤§
                # æ›´æ–°ï¼šæ”¾å…¥ç¬¬ä¸‰å¤§æ®µ
                count[index][2] = length
            
            # ç»§ç»­æ‰«æä¸‹ä¸€æ®µ
            i = j
        
        res = 0
        # å¯¹äºæ¯ä¸ªå­—ç¬¦çš„ä¸‰ä¸ªæ®µé•¿ vec = [max1, max2, max3]ï¼Œå–ä»¥ä¸‹ä¸‰ç§ç»„åˆçš„æœ€å¤§å€¼ï¼š
        # - vec[0] - 2ï¼šæœ€é•¿æ®µå†…éƒ¨æ»‘çª—å‡º 3 ä¸ªï¼ˆLâˆ’k+1â‰¥3 => kâ‰¤Lâˆ’2ï¼‰
        # - min(vec[0] - 1, vec[1])ï¼šä¸€ä¸ªæ®µæ»‘çª—å‡º 2 ä¸ªï¼Œå¦ä¸€ä¸ªæ®µè‡³å°‘ 1 ä¸ª
        # vec[2]ï¼šä¸‰ä¸ªæ®µå„è‡³å°‘ 1 ä¸ª
        # resï¼šå…¨å±€æœ€å¤§å€¼
        for vec in count:
            res = max(res, vec[0] - 2, min(vec[0] - 1, vec[1]), vec[2])
        
        # å¦‚æœ res è¿˜æ˜¯ 0ï¼Œè¯´æ˜æ²¡æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„ï¼Œè¿”å› -1
        return res if res != 0 else -1
```

- æ—¶é—´å¤æ‚åº¦ï¼š`O(n)`ï¼Œå…¶ä¸­ `n` è¡¨ç¤ºå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œåªéœ€éå†ä¸€éå­—ç¬¦ä¸²å³å¯
- ç©ºé—´å¤æ‚åº¦ï¼š`O(âˆ£Î£âˆ£)`ï¼Œå…¶ä¸­ `âˆ£Î£âˆ£` è¡¨ç¤ºå­—ç¬¦é›†çš„å¤§å°ï¼Œéœ€ç»´æŠ¤çš„æ¯ç§å­—ç¬¦æœ€å¤§çš„ä¸‰ä¸ªé•¿åº¦