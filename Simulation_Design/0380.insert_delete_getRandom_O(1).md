# 380.O(1) 时间插入、删除和获取随机元素

题目链接：[380.O(1) 时间插入、删除和获取随机元素](https://leetcode.cn/problems/insert-delete-getrandom-o1/)

## 题目大意

实现 RandomizedSet 类：
- RandomizedSet() 初始化 RandomizedSet 对象
- bool insert(int val) 当元素 val 不存在时，向集合中插入该项，并返回 true ；否则，返回 false 
- bool remove(int val) 当元素 val 存在时，从集合中移除该项，并返回 true ；否则，返回 false 
- int getRandom() 随机返回现有集合中的一项（测试用例保证调用此方法时集合中至少存在一个元素）。每个元素应该有 相同的概率 被返回

你必须实现类的所有函数，并满足每个函数的 平均 时间复杂度为 O(1) 

```js
Example 1:
Input
["RandomizedSet", "insert", "remove", "insert", "getRandom", "remove", "insert", "getRandom"]
[[], [1], [2], [2], [], [1], [2], []]
Output
[null, true, false, true, 2, true, false, 2]

Explanation
RandomizedSet randomizedSet = new RandomizedSet();
randomizedSet.insert(1); // Inserts 1 to the set. Returns true as 1 was inserted successfully.
randomizedSet.remove(2); // Returns false as 2 does not exist in the set.
randomizedSet.insert(2); // Inserts 2 to the set, returns true. Set now contains [1,2].
randomizedSet.getRandom(); // getRandom() should return either 1 or 2 randomly.
randomizedSet.remove(1); // Removes 1 from the set, returns true. Set now contains [2].
randomizedSet.insert(2); // 2 was already in the set, so return false.
randomizedSet.getRandom(); // Since 2 is the only number in the set, getRandom() will always return 2.
```

限制：
- -2^31 <= val <= 2^31 - 1
- At most 2 * 105 calls will be made to insert, remove, and getRandom.
- There will be at least one element in the data structure when getRandom is called.

## 解题

最优解思路：`哈希表 + 数组组合`

我们想要：
- `insert/remove`: 在 `O(1)` 内插入和删除
- `getRandom`: `O(1)` 内随机访问任意元素

于是想到以下数据结构组合：

| 功能 | 数据结构 | 是否满足 O(1) |
| --- | --- | --- |
| 插入 | 哈希表 | ✅ |
| 删除 | 哈希表 + 数组 | ✅（见下方技巧）|
| 随机访问 | 数组 | ✅ |

✅ 删除元素的优化技巧：删除数组中间的元素在数组中不是 `O(1)`（需要移动元素），可以用 “用最后一个元素覆盖被删元素的位置” 来实现 `O(1)` 删除：

```python
class RandomizedSet:
    def __init__(self):
        # 用于存储当前集合中的所有元素，支持随机访问
        self.nums = []
        # 哈希表，记录 val 对应的索引位置，val -> index 的映射，用于快速查找元素位置
        self.valToIndex = {}
        
    def insert(self, val: int) -> bool:
        if val in self.valToIndex:
            return False  # 已存在，不能重复插入
        
        # 记录该值在数组中的索引位置
        self.valToIndex[val] = len(self.nums)
        # 添加到数组尾部
        self.nums.append(val)

        return True

    def remove(self, val: int) -> bool:
        if val not in self.valToIndex:
            return False # 不存在，无法删除
        
        # 找到要删除的元素索引
        index = self.valToIndex[val]
        # 拿到数组最后一个元素
        last_val = self.nums[-1]

        # 用最后一个元素覆盖要删除的元素
        self.nums[index] = last_val
        # 更新哈希表中最后元素的新位置
        self.valToIndex[last_val] = index

        # 删除最后一个元素（已经复制过了）
        self.nums.pop()
        # 删除哈希表中该值的映射
        del self.valToIndex[val]

        return True

    def getRandom(self) -> int:
        # 使用 Python 的 random.randint(0, n-1) 来从数组中随机取值
        # 时间复杂度：O(1)，因为数组支持随机访问
        return self.nums[random.randint(0, len(self.nums) - 1)]
```

- 时间复杂度：`insert、remove、getRandom` -> `O(1)`
- 空间复杂度：`insert、remove、getRandom` -> `O(n)`